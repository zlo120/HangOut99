{% extends "template.html" %}

{% block body %}

{% if current_user.is_authenticated %}
<div id="mobileImage">
    <img class="d-block w-100" src="{{ url_for('static', filename='img/events-mobile.png') }}" alt="Welcoming Image">
</div>

<div id="desktopImage">
    <img class="d-block w-100" src="{{ url_for('static', filename='img/events-desktop.png') }}" alt="Welcoming Image">
</div>
<div class="container">
    <h1 class="mt-3">Here are your upcoming events</h1>

    {% for group in events %}

        {% for events in group %}
        <div class="event">
            <h1>{{events.Name}}</h1>
            <h4>{{events.hangoutgroup.Name}} </h4>
            {% if events.ID in available_event_ids %}                       
                <p class="{{events.ID}}status">You are interested in this event</p>
            {% elif events.ID in unavailable_event_ids %}
                <p class="{{events.ID}}status">You are unavailable for this event</p>
            {% else %}
                <p class="{{events.ID}}status">Please specify if you're interested or not</p>
            {% endif %}
            <hr>
            <p>{{events.Description}}</p>
            <strong>
                {% if events.DateTime %}
                {{events.DateTime.strftime('%d / %m / %y')}}<br>
                {{events.DateTime.strftime('%I:%M %p')}}
                {% else %}
                This is still a plan. Hasn't got a date yet.
                {% endif %}
            </strong>
            <br>
            <hr>
            <div class="eventDiv{{events.ID}}">
                
                <a href="{{url_for('event.event', id = events.ID)}}" class="mt-3 btn btn-secondary">See more details</a>
                <br>
                <button style="margin-top: 2%;" class="btn btn-primary" onClick="eventAvailable{{events.ID}}()">I'm interested</button>
                <button style="margin-left: 1%; margin-top: 2%;" class="btn btn-danger" onClick="eventUnavailable{{events.ID}}()">Can't make it</button>
            </div>

        </div>
        {% endfor %}

    {% endfor %}

    <br><br><br>

</div>

{% else %}

<div id="mobileImage">
    <img class="d-block w-100" src="{{ url_for('static', filename='img/events-mobile.png') }}" alt="Welcoming Image">
</div>

<div id="desktopImage">
    <img class="d-block w-100" src="{{ url_for('static', filename='img/events-desktop.png') }}" alt="Welcoming Image">
</div>

<div class="container">
    <h1 class="mt-5" style="font-size: 5em;">Events are easy to make!</h1>

    <p class="mt-5" style="font-size: 2em;">All you need to do is provide the following</p>

    <br>
    <h3>Required Information</h3>
    <ul>
        <li style="font-size: 1.5em;">Title</li>
        <li style="font-size: 1.5em;">Description</li>
    </ul><br>

    <h3>Optional</h3>
    <ul>
        <li style="font-size: 1.5em;">Date / Time</li>
        <li style="font-size: 1.5em;">Location address</li>
    </ul>
    <br>

    <p class="mt-5" style="font-size: 1.5em;">If you don't provide a Date / Time it will be assumed that this event is a Plan, but don't worry, you can always edit the event in your Account's page. By editing the event you can change any of its details, if you give it a date / time it will become an event.</p>

    <br>

    <p class="mb-5" style="font-size: 1.5em;">Note: there is no difference between an event and a plan, their just names for an event with or without a date / time.</p>
    <br><br><br>
</div>

{% endif %}
{% endblock %}

{% block footer %}display:none;{% endblock %}

{% block script %}

    {% for group in events %}

        {% for event in group %}

            
            function eventAvailable{{event.ID}}() {
                (async () => {
                const rawResponse = await fetch('{{url_for('event.interested')}}' , {
                    method: 'POST',
                    headers: {
                    'Accept': 'application/json',
                    'Content-Type': 'application/json'
                    },
                    body: JSON.stringify( { {{user.ID}} : {'{{event.ID}}': 'interested'}} )
                });

                const content = await rawResponse.json();
        
                console.log(content);
                })();

                $(".{{event.ID}}status").text("You are interested in this event");
            }

            function eventUnavailable{{event.ID}}() {
                (async () => {
                const rawResponse = await fetch('{{url_for('event.unavailable')}}' , {
                    method: 'POST',
                    headers: {
                    'Accept': 'application/json',
                    'Content-Type': 'application/json'
                    },
                    body: JSON.stringify( { {{user.ID}} : {'{{event.ID}}': 'Unavailable'} } )
                });

                const content = await rawResponse.json();
        
                console.log(content);
                })();

                $(".{{event.ID}}status").text("You are unavailable for this event");
            }
            
        {% endfor %}

    {% endfor %}

{% endblock %}